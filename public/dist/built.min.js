function parseMajor(a){return _.chain(a).pluck(aid).pluck(roi).pluck(major).filter(function(a){return void 0!==a}).value()}function parseCost(a){return _.chain(a).pluck(aid).filter(function(a){return void 0!==a[roi][major]}).pluck("cost").value()}function type(a){return{school:a.School,gradRate:parseFloat(a["Grad Rate"]),withoutAid:{cost:parseInt(a["2013cost"]),netROI:majorData(parseInt,a,"_20netroi"),annualROI:majorData(parseFloat,a,"_annualroi")},withAid:{cost:parseInt(a["2013cost_aid"]),netROI:majorData(parseInt,a,"_20netroi_aid"),annualROI:majorData(parseFloat,a,"_annualroi_aid")}}}function majorData(a,b,c){var d={};for(var e in b)if(b.hasOwnProperty(e)&&e.slice(-c.length)===c&&""!==b[e]){var f=e.slice(0,e.length-c.length);d[f]=a(b[e])}return d}var major="All",aid="withoutAid",roi="netROI";$(function(){data.then(function(a){var b=parseMajor(a),c=parseCost(a),d=c3.generate({bindto:"#chart",data:{columns:[["Cost"].concat(c),["Major"].concat(b)],type:"bar",colors:{Cost:"#ff7f0e",Major:"#1f77b4"},groups:[["Major","Cost"]],names:{Major:"20yr Net ROI"}},transition:{duration:800},tooltip:{format:{title:function(b){return a[b].school},value:function(a){var b=d3.format("netROI"===roi?"$,":".");return b(a)}}},grid:{y:{lines:[{value:0}]}},axis:{x:{show:!1},y:{show:!0,tick:{format:d3.format("$,")}}},padding:{bottom:20}});return[d,a]}).then(function(a){var b=a[0],c=a[1];$("#major-filter").submit(function(a){major=$("#active-major").val();var d=parseMajor(c),e=parseCost(c);b.load({unload:["Cost","Major"],columns:[["Cost"].concat(e),["Major"].concat(d)]}),$("#active-major").text(major+" Majors"),a.preventDefault()})})});var csv=Promise.promisify(d3.csv),data=csv("/data.csv",type);