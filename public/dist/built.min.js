function parseSchool(a){return _.chain(a).pluck("school").filter(function(a){return void 0!==a}).map(function(a,b){return b+1+". "+a}).value()}function parseMajor(a){return _.chain(a).pluck(aid).pluck(roi).pluck(major).filter(function(a){return void 0!==a}).value()}function parseCost(a){return _.chain(a).pluck(aid).filter(function(a){return void 0!==a[roi][major]}).pluck("cost").value()}function majorSort(a,b){var c=b[aid][roi][major]+b[aid].cost-(a[aid][roi][major]+a[aid].cost);return c>0?1:0>c?-1:0}function genChart(a,b,c){c3.generate({bindto:"#chart",data:{columns:[["Cost"].concat(b),["Major"].concat(c)],type:"bar",colors:{Cost:"#ff7f0e",Major:"#1f77b4"},groups:[["Major","Cost"]],names:{Major:"20yr Net ROI"}},transition:{duration:800},tooltip:{format:{title:function(b){return b+1+". "+a[b].school},value:function(a){var b=d3.format("netROI"===roi?"$,":".");return b(a)}}},grid:{y:{lines:[{value:0}]}},axis:{x:{show:!1},y:{show:!0,tick:{format:d3.format("$,")}}},padding:{bottom:20}})}function substringMatcher(a){return function(b,c){var d;d=[],substrRegex=new RegExp(b,"i"),$.each(a,function(a,b){substrRegex.test(b)&&d.push({value:b})}),c(d)}}function setSchools(a){$("#school-filter .typeahead").typeahead("destroy"),$("#school-filter .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"schools",displayKey:"value",source:substringMatcher(a)})}function type(a){return{school:a.School,gradRate:parseFloat(a["Grad Rate"]),withoutAid:{cost:parseInt(a["2013cost"]),netROI:majorData(parseInt,a,"_20netroi"),annualROI:majorData(parseFloat,a,"_annualroi")},withAid:{cost:parseInt(a["2013cost_aid"]),netROI:majorData(parseInt,a,"_20netroi_aid"),annualROI:majorData(parseFloat,a,"_annualroi_aid")}}}function majorData(a,b,c){var d={};for(var e in b)if(b.hasOwnProperty(e)&&e.slice(-c.length)===c&&""!==b[e]){var f=e.slice(0,e.length-c.length);d[f]=a(b[e])}return d}var major="All",aid="withoutAid",roi="netROI",schools=[],cost=[],colData=[];$(function(){data.then(function(a){a.sort(majorSort),cost=parseCost(a),colData=parseMajor(a),schools=parseSchool(a),setSchools(schools);var b=genChart(a,cost,colData);return[b,a]}).then(function(a){var b=(a[0],a[1]),c=10;$("#major-filter").change(function(a){a.preventDefault(),major=$("option:selected").text(),c=10;var d=_.filter(b,function(a){return void 0!==a[aid][roi][major]});d.sort(majorSort),cost=parseCost(d),colData=parseMajor(d),schools=parseSchool(d),setSchools(schools),genChart(d,cost,colData),$("#active-major").text(major+" Majors")}),$("#school-filter").submit(function(a){a.preventDefault();var b=$("#active-school").val(),d=schools.indexOf(b),e=".c3-event-rect-"+d,f=d3.select(e).attr("x"),g=0,h=d3.select(e).attr("width"),i=d3.select(e).attr("height");d3.select("g").append("rect").attr("x",f).attr("y",g).attr("width",h).attr("height",i).style("fill","#1f77b4").style("fill-opacity","0.25"),d3.select("g").append("text").append("tspan").attr("x",f).attr("y",c).text(b).append("tspan").attr("x",f).attr("y",c+15).text("Cost: "+cost[d]).append("tspan").attr("x",f).attr("y",c+30).text("ROI: "+colData[d]),c+=50})})});var csv=Promise.promisify(d3.csv),data=csv("/data.csv",type);